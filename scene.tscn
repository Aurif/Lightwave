[gd_scene load_steps=26 format=3 uid="uid://cro2m5utrrmnf"]

[ext_resource type="Texture2D" uid="uid://228xusoviqnl" path="res://assets/sprites/base.png" id="3_3253y"]
[ext_resource type="Texture2D" uid="uid://cojumbjwvp5mf" path="res://assets/sprites/bg.png" id="3_m7jmp"]
[ext_resource type="PackedScene" uid="uid://chs5l1e6nieeb" path="res://components/mol/laser/laser.tscn" id="3_u3cyc"]
[ext_resource type="Script" uid="uid://bw0oganconan3" path="res://components/org/enemy_manager/enemy_manager.gd" id="4_m7jmp"]
[ext_resource type="PackedScene" uid="uid://0x73rcsem3bv" path="res://components/mol/enemy/enemy.tscn" id="5_y2354"]
[ext_resource type="PackedScene" uid="uid://cqmda3rv1r53e" path="res://components/mol/enemy/enemy_speedy.tscn" id="6_akxrc"]
[ext_resource type="Script" uid="uid://dtvs6dv3k5mdl" path="res://components/org/bullet_tracer/bullet_tracer.gd" id="6_ni31j"]
[ext_resource type="Texture2D" uid="uid://b8k4vbrr0xegr" path="res://assets/sprites/laser_point.png" id="6_y2354"]
[ext_resource type="Shader" uid="uid://dfsvbot1app06" path="res://components/org/darkness/shader.gdshader" id="8_73fnb"]
[ext_resource type="Texture2D" uid="uid://w2rg8dybf6gw" path="res://assets/sprites/bg_shadow.png" id="8_xlvrw"]
[ext_resource type="FontFile" uid="uid://cw75qkqjyv60b" path="res://assets/fonts/3x5.png" id="10_5juve"]
[ext_resource type="Script" uid="uid://bnra6i6bvh81g" path="res://components/org/hp/hp.gd" id="11_fy5k1"]
[ext_resource type="Script" uid="uid://b3uxc4gps3b3j" path="res://components/org/restart/restart.gd" id="12_5c1cw"]

[sub_resource type="WorldBoundaryShape2D" id="WorldBoundaryShape2D_3253y"]
normal = Vector2(1, 0)

[sub_resource type="WorldBoundaryShape2D" id="WorldBoundaryShape2D_u3cyc"]
normal = Vector2(-1, 0)

[sub_resource type="WorldBoundaryShape2D" id="WorldBoundaryShape2D_m7jmp"]
normal = Vector2(0, 1)

[sub_resource type="WorldBoundaryShape2D" id="WorldBoundaryShape2D_y2354"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_u3cyc"]
size = Vector2(120, 1)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_ni31j"]
size = Vector2(5, 5)

[sub_resource type="ViewportTexture" id="ViewportTexture_73fnb"]
viewport_path = NodePath("Darkness/Mask")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_73fnb"]
resource_local_to_scene = true
shader = ExtResource("8_73fnb")
shader_parameter/mask_tex = SubResource("ViewportTexture_73fnb")

[sub_resource type="Gradient" id="Gradient_73fnb"]
colors = PackedColorArray(0, 0, 0, 1, 0, 0, 0, 0)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_5juve"]
gradient = SubResource("Gradient_73fnb")
fill_from = Vector2(0.50934577, 0)

[sub_resource type="Gradient" id="Gradient_5juve"]
interpolation_mode = 2
offsets = PackedFloat32Array(0, 0.48, 0.52, 1)
colors = PackedColorArray(0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_fy5k1"]
gradient = SubResource("Gradient_5juve")

[node name="Root" type="Node2D"]

[node name="PlayArea" type="Node" parent="."]

[node name="BG - Color" type="ColorRect" parent="PlayArea"]
offset_right = 320.0
offset_bottom = 180.0
color = Color(0.16862746, 0.16078432, 0.22745098, 1)

[node name="BG - Pattern" type="TextureRect" parent="PlayArea"]
texture_filter = 1
offset_left = 40.0
offset_right = 320.0
offset_bottom = 180.0
texture = ExtResource("3_m7jmp")
stretch_mode = 1

[node name="Base" type="NinePatchRect" parent="PlayArea"]
z_index = 10
texture_filter = 1
offset_right = 40.0
offset_bottom = 180.0
texture = ExtResource("3_3253y")
region_rect = Rect2(0, 0, 36, 8)
patch_margin_left = 32
axis_stretch_horizontal = 1
axis_stretch_vertical = 1

[node name="WorldBorder" type="StaticBody2D" parent="PlayArea"]
collision_layer = 2
collision_mask = 0

[node name="Left" type="CollisionShape2D" parent="PlayArea/WorldBorder"]
position = Vector2(-3, 1)
shape = SubResource("WorldBoundaryShape2D_3253y")

[node name="Right" type="CollisionShape2D" parent="PlayArea/WorldBorder"]
position = Vector2(323, 6)
shape = SubResource("WorldBoundaryShape2D_u3cyc")

[node name="Top" type="CollisionShape2D" parent="PlayArea/WorldBorder"]
position = Vector2(211, -5)
shape = SubResource("WorldBoundaryShape2D_m7jmp")

[node name="Bottom" type="CollisionShape2D" parent="PlayArea/WorldBorder"]
position = Vector2(186, 183)
shape = SubResource("WorldBoundaryShape2D_y2354")

[node name="Wall - Top" type="ColorRect" parent="PlayArea"]
z_index = 10
offset_top = 10.0
offset_right = 120.0
offset_bottom = 11.0
color = Color(0.32941177, 0.2627451, 0.41960785, 1)

[node name="StaticBody2D" type="StaticBody2D" parent="PlayArea/Wall - Top"]
collision_layer = 2

[node name="CollisionShape2D" type="CollisionShape2D" parent="PlayArea/Wall - Top/StaticBody2D"]
position = Vector2(60, 0.5)
shape = SubResource("RectangleShape2D_u3cyc")

[node name="Wall - Bottom" type="ColorRect" parent="PlayArea"]
z_index = 10
offset_top = 179.0
offset_right = 120.0
offset_bottom = 180.0
color = Color(0.32941177, 0.2627451, 0.41960785, 1)

[node name="StaticBody2D" type="StaticBody2D" parent="PlayArea/Wall - Bottom"]
collision_layer = 2

[node name="CollisionShape2D" type="CollisionShape2D" parent="PlayArea/Wall - Bottom/StaticBody2D"]
position = Vector2(60, 0.5)
shape = SubResource("RectangleShape2D_u3cyc")

[node name="Lasers" type="Node" parent="."]

[node name="Laser" parent="Lasers" instance=ExtResource("3_u3cyc")]
position = Vector2(50, 45)

[node name="Laser2" parent="Lasers" instance=ExtResource("3_u3cyc")]
position = Vector2(50, 95)

[node name="Laser3" parent="Lasers" instance=ExtResource("3_u3cyc")]
position = Vector2(50, 145)

[node name="Enemies" type="Node2D" parent="." node_paths=PackedStringArray("wave_label", "light_overlay", "show_on_victory")]
position = Vector2(320, 10)
script = ExtResource("4_m7jmp")
enemy_prefab = ExtResource("5_y2354")
enemy_variants_prefab = Array[PackedScene]([ExtResource("6_akxrc")])
max_size = Vector2i(25, 17)
wave_label = NodePath("../UI/LabelWave")
light_overlay = NodePath("../Darkness/Mask/ForcedLight")
show_on_victory = NodePath("../UI/VictoryScreen")

[node name="BulletTracer" type="Node" parent="." node_paths=PackedStringArray("laser", "light_pass")]
script = ExtResource("6_ni31j")
laser = NodePath("Bullet")
light_pass = NodePath("../Darkness/Mask/LightPassAnchor")

[node name="Bullet" type="Area2D" parent="BulletTracer"]
visible = false
position = Vector2(55, 15)
collision_layer = 8
collision_mask = 4

[node name="CollisionShape2D" type="CollisionShape2D" parent="BulletTracer/Bullet"]
shape = SubResource("RectangleShape2D_ni31j")

[node name="Sprite2D" type="Sprite2D" parent="BulletTracer/Bullet"]
z_index = 2
texture_filter = 1
texture = ExtResource("6_y2354")

[node name="Darkness" type="Node" parent="."]

[node name="Sprite" type="TextureRect" parent="Darkness"]
z_index = 1
texture_filter = 1
material = SubResource("ShaderMaterial_73fnb")
offset_right = 320.0
offset_bottom = 180.0
texture = ExtResource("8_xlvrw")
stretch_mode = 1

[node name="Mask" type="SubViewport" parent="Darkness"]
handle_input_locally = false
size = Vector2i(320, 180)
render_target_update_mode = 4

[node name="BG" type="ColorRect" parent="Darkness/Mask"]
offset_right = 320.0
offset_bottom = 180.0

[node name="Base - gradient" type="TextureRect" parent="Darkness/Mask"]
offset_right = 136.0
offset_bottom = 180.0
texture = SubResource("GradientTexture2D_5juve")

[node name="LightPassAnchor" type="Node2D" parent="Darkness/Mask"]
visible = false
position = Vector2(193, 0)

[node name="LightPassGradient" type="TextureRect" parent="Darkness/Mask/LightPassAnchor"]
offset_left = -42.0
offset_right = 42.0
offset_bottom = 180.0
texture = SubResource("GradientTexture2D_fy5k1")

[node name="ForcedLight" type="ColorRect" parent="Darkness/Mask"]
modulate = Color(1, 1, 1, 0)
custom_minimum_size = Vector2(320, 180)
offset_right = 40.0
offset_bottom = 40.0
color = Color(0, 0, 0, 1)

[node name="UI" type="Node2D" parent="."]
z_index = 100

[node name="Bg" type="ColorRect" parent="UI"]
offset_right = 320.0
offset_bottom = 10.0
color = Color(0.011764706, 0.023529412, 0.09019608, 1)

[node name="LabelHP" type="Label" parent="UI" node_paths=PackedStringArray("label", "show_on_gameover")]
texture_filter = 1
offset_left = 9.0
offset_top = 3.0
offset_right = 31.0
offset_bottom = 8.0
theme_override_colors/font_color = Color(0.32941177, 0.2627451, 0.41960785, 1)
theme_override_fonts/font = ExtResource("10_5juve")
theme_override_font_sizes/font_size = 7
text = "HP: 10"
script = ExtResource("11_fy5k1")
label = NodePath(".")
show_on_gameover = NodePath("../GameOver")

[node name="LabelWave" type="Label" parent="UI" node_paths=PackedStringArray("label", "show_on_gameover")]
visible = false
texture_filter = 1
offset_top = 2.0
offset_right = 320.0
offset_bottom = 7.0
theme_override_colors/font_color = Color(0.32941177, 0.2627451, 0.41960785, 1)
theme_override_fonts/font = ExtResource("10_5juve")
theme_override_font_sizes/font_size = 7
text = "Wave: 0"
horizontal_alignment = 1
script = ExtResource("11_fy5k1")
label = NodePath(".")
show_on_gameover = NodePath("../GameOver")

[node name="GameOver" type="ColorRect" parent="UI"]
process_mode = 3
visible = false
modulate = Color(1, 1, 1, 0)
offset_right = 320.0
offset_bottom = 180.0
color = Color(0.011764706, 0.023529412, 0.09019608, 1)

[node name="LABEL" type="Label" parent="UI/GameOver"]
texture_filter = 1
layout_mode = 0
offset_top = 44.0
offset_right = 320.0
offset_bottom = 95.0
theme_override_colors/font_color = Color(0.32941177, 0.2627451, 0.41960785, 1)
theme_override_fonts/font = ExtResource("10_5juve")
theme_override_font_sizes/font_size = 16
text = "AND THEN THERE WAS
nothing but
"
horizontal_alignment = 1

[node name="LABEL2" type="Label" parent="UI/GameOver"]
texture_filter = 1
layout_mode = 0
offset_top = 90.0
offset_right = 320.0
offset_bottom = 141.0
theme_override_colors/font_color = Color(0.32941177, 0.2627451, 0.41960785, 1)
theme_override_fonts/font = ExtResource("10_5juve")
theme_override_font_sizes/font_size = 26
text = "DARKNESS"
horizontal_alignment = 1

[node name="LABEL3" type="Label" parent="UI/GameOver"]
process_mode = 2
texture_filter = 1
layout_mode = 0
offset_top = 143.0
offset_right = 320.0
offset_bottom = 149.0
theme_override_colors/font_color = Color(0.32941177, 0.2627451, 0.41960785, 1)
theme_override_fonts/font = ExtResource("10_5juve")
theme_override_font_sizes/font_size = 7
text = "press w to try again"
horizontal_alignment = 1
script = ExtResource("12_5c1cw")

[node name="VictoryScreen" type="Label" parent="UI"]
visible = false
modulate = Color(1, 1, 1, 0)
texture_filter = 1
offset_left = 81.0
offset_top = 10.0
offset_right = 320.0
offset_bottom = 180.0
theme_override_colors/font_color = Color(0.32941177, 0.2627451, 0.41960785, 1)
theme_override_fonts/font = ExtResource("10_5juve")
theme_override_font_sizes/font_size = 16
text = "Good job!
you did it :)"
horizontal_alignment = 1
vertical_alignment = 1

[node name="TitleScreen" type="Node2D" parent="."]
z_index = 19

[node name="Game Name" type="Label" parent="TitleScreen"]
texture_filter = 1
offset_left = 145.0
offset_top = 20.0
offset_right = 319.0
offset_bottom = 53.0
theme_override_colors/font_color = Color(0.32941177, 0.2627451, 0.41960785, 1)
theme_override_fonts/font = ExtResource("10_5juve")
theme_override_font_sizes/font_size = 13
text = "what comes 
from the dark"
horizontal_alignment = 1

[node name="TextureRect" type="TextureRect" parent="TitleScreen/Game Name"]
show_behind_parent = true
layout_mode = 0
offset_left = 5.0
offset_right = 165.0
offset_bottom = 35.0
texture = ExtResource("8_xlvrw")
stretch_mode = 1

[node name="Instruction" type="Label" parent="TitleScreen"]
texture_filter = 1
offset_left = 161.0
offset_top = 84.0
offset_right = 301.0
offset_bottom = 117.0
theme_override_colors/font_color = Color(0.32941177, 0.2627451, 0.41960785, 1)
theme_override_fonts/font = ExtResource("10_5juve")
theme_override_font_sizes/font_size = 7
text = " A/D  - Steer turret left and right
  W   - change shooting angle
shift - shoot"

[node name="TextureRect" type="TextureRect" parent="TitleScreen/Instruction"]
show_behind_parent = true
layout_mode = 0
offset_left = -1.0
offset_top = -4.0
offset_right = 140.0
offset_bottom = 25.0
texture = ExtResource("8_xlvrw")
stretch_mode = 1

[node name="Goal" type="Label" parent="TitleScreen"]
texture_filter = 1
offset_left = 145.0
offset_top = 143.0
offset_right = 319.0
offset_bottom = 149.0
theme_override_colors/font_color = Color(0.32941177, 0.2627451, 0.41960785, 1)
theme_override_fonts/font = ExtResource("10_5juve")
theme_override_font_sizes/font_size = 7
text = "GOal: survive"
horizontal_alignment = 1

[node name="TextureRect" type="TextureRect" parent="TitleScreen/Goal"]
show_behind_parent = true
layout_mode = 0
offset_left = 55.0
offset_top = -3.0
offset_right = 115.0
offset_bottom = 7.0
texture = ExtResource("8_xlvrw")
stretch_mode = 1

[connection signal="FireLaser" from="Lasers/Laser" to="BulletTracer" method="start_laser"]
[connection signal="FireLaser" from="Lasers/Laser" to="TitleScreen" method="hide" unbinds=2]
[connection signal="FireLaser" from="Lasers/Laser" to="UI/LabelWave" method="show" unbinds=2]
[connection signal="OnFired" from="Lasers/Laser" to="Lasers/Laser2" method="set_active"]
[connection signal="FireLaser" from="Lasers/Laser2" to="BulletTracer" method="start_laser"]
[connection signal="OnFired" from="Lasers/Laser2" to="Lasers/Laser3" method="set_active"]
[connection signal="FireLaser" from="Lasers/Laser3" to="BulletTracer" method="start_laser"]
[connection signal="OnFired" from="Lasers/Laser3" to="Enemies" method="tick_enemies"]
[connection signal="AfterTick" from="Enemies" to="Lasers/Laser" method="set_active"]
[connection signal="OnDamageTaken" from="Enemies" to="UI/LabelHP" method="reduce_hp"]
